############################################################################
# Copyright 2007-2025 Universidade do Porto - Faculdade de Engenharia      #
# Laboratório de Sistemas e Tecnologia Subaquática (LSTS)                  #
############################################################################
# This file is part of DUNE: Unified Navigation Environment.               #
#                                                                          #
# Commercial Licence Usage                                                 #
# Licencees holding valid commercial DUNE licences may use this file in    #
# accordance with the commercial licence agreement provided with the       #
# Software or, alternatively, in accordance with the terms contained in a  #
# written agreement between you and Faculdade de Engenharia da             #
# Universidade do Porto. For licensing terms, conditions, and further      #
# information contact lsts@fe.up.pt.                                       #
#                                                                          #
# Modified European Union Public Licence - EUPL v.1.1 Usage                #
# Alternatively, this file may be used under the terms of the Modified     #
# EUPL, Version 1.1 only (the "Licence"), appearing in the file LICENCE.md #
# included in the packaging of this file. You may not use this work        #
# except in compliance with the Licence. Unless required by applicable     #
# law or agreed to in writing, software distributed under the Licence is   #
# distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF     #
# ANY KIND, either express or implied. See the Licence for the specific    #
# language governing permissions and limitations at                        #
# https://github.com/LSTS/dune/blob/master/LICENCE.md and                  #
# http://ec.europa.eu/idabc/eupl.html.                                     #
############################################################################
# Author: Pedro Gonçalves                                                  #
############################################################################
# LAUV Xplore 6 configuration file                                         #
############################################################################

[Require auv/basic.ini]
[Require hardware/lctr-a6xx/basic.ini]
[Require hardware/lctr-rpi/thermalzone.ini]

############################################################################
# General Parameters.                                                      #
############################################################################

[General]
Vehicle                                           = lauv-xplore-8
Absolute Maximum Depth                            = 300
Absolute Minimum Altitude                         = 1.2
Battery Packs                                     = 8
Battery Capacity                                  = 1400
Power Model -- Conversion - Watt                  = 0, 14, 20, 54, 70
Power Model -- Conversion - RPM                   = 0, 500, 850, 1250, 1400
Speed Conversion -- Actuation                     = 0, 36, 46
Speed Conversion -- RPM                           = 0, 900, 1150
Speed Conversion -- MPS                           = 0, 1, 1.3
Maximum Absolute Speed                            = 2.1
Hardware List                                     = OMST PCTLv3,
                                                    IEI PM-LX2-800W,
                                                    Raspberry Pi 4,
                                                    Ubiquiti PicoStation M2HP,
                                                    TP-LINK SF1008D,
                                                    GSM/UMTS/HDSPA,
                                                    U-blox EVK-6H,
                                                    Keller-33x,
                                                    LSTS BROOM + Motor,
                                                    LSTS SCRTv4 + BMS-705MG,
                                                    RBR Legato3

############################################################################
# Actuators.                                                               #
############################################################################

[Actuators.SCRTv4]
Enabled                                           = Hardware
Entity Label                                      = Servo Controller
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
Serial Port - Device                              = /dev/ttyS2
Servo Directions                                  = 1, -1, 1, -1

[Actuators.Broom]
Enabled                                           = Hardware
Execution Frequency                               = 10
State Sampling Frequency                          = 0.5
Motor Pole Pairs                                  = 12
Serial Port - Device                              = /dev/ttyS0
Thrust Control Mode                               = rpm
Inverted Rotation                                 = true
Accept DesiredSpeed Messages                      = false
Entity Label                                      = Motor Controller
Motor - Entity Label                              = Motor
Bridge - Entity Label                             = Motor Controller (Bridge)
MCU - Entity Label                                = Motor Controller (MCU)
Timeout - Error                                   = 4.0
Timeout - Failure                                 = 8.0

############################################################################
# Autonomy.                                                                #
############################################################################

############################################################################
# Control.                                                                 #
############################################################################

[Control.AUV.Allocator]
Fin effect Rpm minimum value                      = 200
Fin effect Velocity dependent                     = false
Fin effect Velocity dependent unit                = RPM
Fin effect minimum Meter Per Second value         = 0.2
Roll not velocity dependent                       = true
k pitch                                           = 1.3
k roll                                            = 2.0
k yaw                                             = 2.0

[Control.AUV.Attitude]
Depth Integral Limit                              = 5.0
Depth PID Gains                                   = 0.5, 0.008, 0.1
Depth-to-pitch PID sampling rate relation         = 2
Maximum Pitch Reference                           = 15.0
Pitch Integral Limit                              = 25.0
Pitch PID Gains                                   = 1.8, 0.0, 0.0
Roll Integral Limit                               = 5.0
Roll PID Gains                                    = 0.4, 0.05, 0.3
Roll Compensation -- Use Speed                    = false
Roll Compensation -- Speed Gain                   = 0.2
Heading Rate PID Gains                            = 1.2, 0.0, 0.0
Heading PID Gains                                 = 1.5, 0.0, 0.15
Pitch Angle At Surface                            = 5.0

[Control.AUV.RemoteOperation]
Pitch Reference                                   = 5.0

############################################################################
# Maneuver.                                                                #
############################################################################

# Use pure pursuit path controller
#[Require common/pure-pursuit.ini]
[Maneuver.Multiplexer]
PopUp -- Report at PopUps                         = true

############################################################################
# Navigation.                                                              #
############################################################################

[Navigation.AUV.Navigation]
GPS Maximum HACC                                  = 40.0
Distance Between LBL and GPS                      = 0.98
Abort if Uncertainty Exceeded                     = false
Activate speed to rpm estimation limit            = true
Depth sensor localization in x axis               = 0.92
Rpm to speed estimation                           = true
speed to rpm estimation percentage limit          = 15

############################################################################
# Monitors.                                                                #
############################################################################

[Monitors.Boot]
Enabled                                           = Hardware
Entity Label                                      = Boot Monitor
Boot Message Delay                                = 10
Boot Message TTL                                  = 300
Task Label for SMS Number                         = Monitors.Emergency
Task Parameter for SMS Number                     = SMS Recipient Number
External Info Text                                = lauv-xplore-8

[Monitors.Clock]
Enabled                                           = Hardware
Entity Label                                      = Clock
Minimum GPS Fixes                                 = 30
Maximum Clock Offset                              = 2
Boot Synchronization Timeout                      = 60
Debug Level                                       = Spew
Hardware Clock Synchronization Command            = hwclock -w

[Monitors.CPUScaling]
Enabled                                           = Hardware, HIL
Entity Label                                      = CPU Scaling
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None
# powersave, ondemand, performance
Set CPU In Mode                                   = ondemand
# CPU ARIES: 500MHz <> 1900MHz
Set Maximum CPU Frequency in MHz                  = 500

[Monitors.Emergency]
Enabled                                           = Hardware
Active                                            = true
Transmission Interface                            = Both
Lost Communications Timeout                       = 1800
SMS Recipient Number                              = +351912439480
External Info Text                                = lauv-xplore-8

[Monitors.Entities]
Default Monitoring                                = Attitude,
                                                    CTD,
                                                    Daemon,
                                                    GPS,
                                                    Navigation,
                                                    Operational Limits,
                                                    Path Control
Default Monitoring -- Hardware                    = AHRS,
                                                    Clock,
                                                    Collisions,
                                                    Diving,
                                                    Medium Sensor,
                                                    Leak Sensor,
                                                    Motor Controller,
                                                    Power Supply,
                                                    Servo Controller

[Monitors.FuelLevel]
Enabled                                           = Never

[Monitors.HostResources]
Enabled                                           = Always
Entity Label                                      = Host Resources
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None

[Monitors.Medium]
# Reported sound speed in air is 1450...
Sound Speed Threshold                             = 1600
Entity Label - Medium Sensor                      = Medium Sensor

############################################################################
# Power.                                                                   #
############################################################################

[Power.PCTLv2]
Enabled                                           = Never

[Power.PCTLv3]
Enabled                                           = Hardware
Entity Label                                      = Power Supply
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
Minimum Operating Voltage                         = 19.5
Wakeup Operating Voltage                          = 24
Channel States - Emergency                        = 0x01, 0x00, 0x00
Watchdog Timeout                                  = 2.0
Serial Port - Device                              = /dev/ttyS3
LED - Names                                       = Green, Red, White - Back, White - Top
Leak 0 - Entity Label                             = Medium Sensor
Leak 0 - Medium Sensor                            = true
Leak 1 - Entity Label                             = Leak Sensor
Leak 1 - Medium Sensor                            = false
Power Channel Main - Name                         = System
Power Channel 0 - Name                            = Private (ATX)
Power Channel 0 - State                           = 1
Power Channel 1 - Name                            = RBR
Power Channel 1 - State                           = 1
Power Channel 2 - Name                            = SADC
Power Channel 2 - State                           = 1
Power Channel 3 - Name                            = N/C (+12V_5)
Power Channel 3 - State                           = 0
Power Channel 4 - Name                            = Iridium
Power Channel 4 - State                           = 1
Power Channel 5 - Name                            = N/C (Bout_2)
Power Channel 5 - State                           = 0
Power Channel 6 - Name                            = N/C (Bout_3)
Power Channel 6 - State                           = 0
Power Channel 7 - Name                            = Echo Sounder
Power Channel 7 - State                           = 1
Power Channel 8 - Name                            = Private (CPU)
Power Channel 8 - State                           = 1
Power Channel 9 - Name                            = GPS
Power Channel 9 - State                           = 1
Power Channel 10 - Name                           = LTE
Power Channel 10 - State                          = 1
Power Channel 11 - Name                           = CPU-AUX
Power Channel 11 - State                          = 1
Power Channel 12 - Name                           = N/C (+5V_5)
Power Channel 12 - State                          = 0
Power Channel 13 - Name                           = AHRS
Power Channel 13 - State                          = 1
Power Channel 14 - Name                           = Radio
Power Channel 14 - State                          = 1
Power Channel 15 - Name                           = Optode
Power Channel 15 - State                          = 1
Power Channel 16 - Name                           = N/C (IMU)
Power Channel 16 - State                          = 0
Power Channel 17 - Name                           = N/C (DVL)
Power Channel 17 - State                          = 0
Fuel Level Warning 1                              = 25
Fuel Level Warning 2                              = 20
Fuel Level Warning 3                              = 15
Fuel Level Error                                  = 10
#off, air, water
Emulate Medium Sensor                             = off
Fuel Level Stop Logging                           = 5.0
Low Confidence Level                              = 90.0
Timeout - TCP Rx                                  = 0.1
Timeout - TCP Tx                                  = 0.1

############################################################################
# Sensors.                                                                 #
############################################################################

[Sensors.GPS]
Enabled                                           = Hardware
Active                                            = true
Entity Label                                      = GPS
Activation Time                                   = 10
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
Input Timeout                                     = 4.0
Power Channel - Names                             = GPS
IO Port - Device                                  = tcp://10.0.10.232:35501
Sentence Order                                    = GNVTG, GNZDA, PUBX
Initialization String 0 - Command                 = $PUBX,40,VTG,0,1,0,0,0,0\r\n
Initialization String 1 - Command                 = $PUBX,40,ZDA,0,1,0,0,0,0\r\n
Initialization String 2 - Command                 = $PUBX,40,00,0,1,0,0,0,0\r\n
Initialization String 3 - Command                 = $PUBX,40,GLL,0,0,0,0,0,0\r\n
Initialization String 4 - Command                 = $PUBX,40,GSA,0,0,0,0,0,0\r\n
Initialization String 5 - Command                 = $PUBX,40,GSV,0,0,0,0,0,0\r\n
Initialization String 6 - Command                 = $PUBX,40,RMC,0,0,0,0,0,0\r\n
Initialization String 7 - Command                 = $PUBX,40,GGA,0,0,0,0,0,0\r\n
Initialization String 8 - Command                 = $PUBX,40,GLL,0,0,0,0,0,0\r\n

[Sensors.Imagenex852v2]
Enabled                                           = Hardware
Entity Label                                      = Echo Sounder
Active                                            = false
Active - Scope                                    = idle
Active - Visibility                               = user
Activation Time                                   = 3.0
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
IO Port - Device                                  = tcp://10.0.10.232:35508
Sampling Frequency                                = 5
Connect to Device                                 = true
Filter Average Elements                           = 10
Filter Threshold                                  = 20
Filter Cluster Size                               = 7
Filter Low Pass                                   = 0.8, 0.1, 0.1
Filter Min Distance                               = 0.5
Sonar orientation                                 = 0, 0, 0
Sonar position                                    = 1, 0, 0
Sound Speed on Water                              = 1500
Use Device at Surface                             = false
Use Dynamic Sound Speed                           = false
Range                                             = 30
Start Gain                                        = 20
Pulse Length                                      = 0.000030
Profile Minimum Range                             = 0
Data Points                                       = 500
Filter Enabled                                    = true
Pattern Filter Enabled                            = false
Pattern Filter Difference                         = 50
Automatic Activation                              = true

[Sensors.Keller]
Enabled                                           = Hardware
Activation Time                                   = 3.0
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
Entity Label                                      = Depth Sensor
Entity Label - GPS                                = GPS
IO Port - Device                                  = tcp://10.0.10.232:35503
Serial Port - Local Echo                          = false
Device Address                                    = 250
Water Density                                     = 1025.0
Timeout - Error                                   = 4.0
Timeout - Failure                                 = 8.0

[Sensors.MicrostrainMIP]
Enabled                                           = Hardware
Entity Label                                      = AHRS
Execution Priority                                = 10
Debug Level                                       = None
Activation Time                                   = 0
Deactivation Time                                 = 0
Serial Port - Device                              = /dev/ttyS1
Serial Port - Baud Rate                           = 115200
Sampling Frequency                                = 50
Timeout - Error                                   = 4
Timeout - Failure                                 = 8
Hard-Iron Calibration                             = 0.0, 0.0, 0.0
#APDL
#Hard-Iron Calibration                             = 0.0771, -0.0336, 0.0
#Sesimbra
#Hard-Iron Calibration                            = 0.0246, -0.0308, 0.0
Calibration Threshold                             = 0.005
IMU Rotation Matrix                               = 1.0,  0.0,  0.0,
                                                    0.0,  1.0,  0.0,
                                                    0.0,  0.0,  1.0

[Sensors.Optode4831]
Enabled                                           = Hardware
Entity Label                                      = Oxygen Sensor
Activation Time                                   = 10.0
Debug Level                                       = None
IO Port - Device                                  = tcp://10.0.10.232:35507
#Power Channel - Names                             = Optode
#Post Power On Delay                               = 2.0
Sampling Interval                                 = 1.0
Measurement String Identifier                     = 4831F
Automatic Activation                              = true

[Sensors.RBRlegato3AUV]
Enabled                                           = Hardware
Entity Label                                      = CTD
Debug Level                                       = None
Activation Time                                   = 10.0
IO Port - Device                                  = tcp://10.0.10.232:35504
#Power Channel - Names                             = RBR
#Post Power On Delay                               = 4.0
Input Timeout                                     = 10

[Sensors.SADC]
Enabled                                           = Hardware
Entity Label                                      = SADC
IO Port - Device                                  = tcp://10.0.10.232:35506
Debug Level                                       = None
Activation Time                                   = 5
Sample Rate                                       = 1
Samples to Switch Gain                            = 5
ADC Conversion Factor                             = 6.14
#Power Channel - Names                             = SADC
ADC 1 - Is Active                                 = true
ADC 1 - Minimum Value                             = 0.3
ADC 1 - Maximum Value                             = 4.7
ADC 1 - Fixed Gain                                = false
ADC 1 - Fixed Gain Value                          = 1
ADC 1 - Entity Label                              = Chlorophyll
ADC 2 - Is Active                                 = true
ADC 2 - Minimum Value                             = 0.3
ADC 2 - Maximum Value                             = 4.7
ADC 2 - Fixed Gain                                = false
ADC 2 - Fixed Gain Value                          = 1
ADC 2 - Entity Label                              = Turbidity
ADC 3 - Is Active                                 = false
ADC 3 - Minimum Value                             = 0.3
ADC 3 - Maximum Value                             = 4.7
ADC 3 - Fixed Gain                                = false
ADC 3 - Fixed Gain Value                          = 1
ADC 3 - Entity Label                              =
ADC 4 - Is Active                                 = false
ADC 4 - Minimum Value                             = 0.3
ADC 4 - Maximum Value                             = 4.7
ADC 4 - Fixed Gain                                = false
ADC 4 - Fixed Gain Value                          = 1
ADC 4 - Entity Label                              =

[Sensors.SCH311X]
Enabled                                           = Never

[Sensors.ThermalZone]
Enabled                                           = Hardware
Entity Label                                      = Thermal Zone
Execution Frequency                               = 1
Path                                              = /sys/class/thermal/thermal_zone0/temp
Entity Label - Temperature                        = Mainboard (Core)

############################################################################
# Simulators.                                                              #
############################################################################

[Simulators.Environment]
Simulate - Bottom Distance                        = false
Simulate - Forward Distance                       = false

[Simulators.DepthSensor]
Enabled                                           = Simulation
Execution Frequency                               = 10
Entity Label                                      = Depth Sensor
Standard Deviation                                = 0.05

[Simulators.IMU/AHRS]
Enabled                                           = Simulation
Entity Label                                      = AHRS
Standard Deviation - Euler Angles                 = 0.05
Standard Deviation - Angular Velocity             = 0.05
Standard Deviation - Heading Offset               = 0
Gyro Rate Bias                                    = 0

############################################################################
# Supervisors.                                                             #
############################################################################

[Supervisors.ClockPPS]
Enabled                                           = Never

[Supervisors.Power]
Enabled                                           = Hardware
Entity Label                                      = Power Supervisor
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None
Execution Priority                                = 10
Main Power Channel                                = System
Command - On Power Down                           = systemctl poweroff
Command - On Power Down Abort                     =

############################################################################
# Transports.                                                              #
############################################################################

[Transports.FTP]
Enabled                                           = Simulation

#[Transports.Announce]
#Ignored Interfaces                                = eth1:prv

[Transports.Announce]
Enabled                                           = Simulation

[Transports.Announce/Hardware]
Enabled                                           = Hardware
Additional Services - External                    = ftp://10.188.10.210:30021/
Entity Label                                      = Service Announcer
Activation Time                                   = 0
Deactivation Time                                 = 0
Debug Level                                       = None
Debug Level                                       = None
Execution Priority                                = 10
Announcement Periodicity                          = 10
Enable Loopback                                   = 1
Enable Multicast                                  = 1
Enable Broadcast                                  = 1
Multicast Address                                 = 224.0.75.69
Ports                                             = 30100, 30101, 30102, 30103, 30104
Ignored Interfaces                                = eth1:prv

[Transports.Iridium]
Enabled                                           = Hardware
Entity Label                                      = Iridium Transport
Device updates - Periodicity                      = 600
Announce Periodicity                              = 600
Active                                            = true

[Transports.IridiumSBD]
Enabled                                           = Hardware
Debug Level                                       = None
Entity Label                                      = Iridium Modem
IO Port - Device                                  = tcp://10.0.10.232:35505
IO Port - Device 9523                             = uart:///dev/ttyS3:115200
Use 9523N Module                                  = false
Mailbox Check - Periodicity                       = 300
Active                                            = true
Transmission Window                               = 300
Reception Window                                  = 60
Monitor Iridium Modems                            = false
Monitor Iridium Task Label                        = CPC

[Transports.LoggingDigest]
Enabled                                           = Hardware
Entity Label                                      = Logger (Digest)
Sample Interval                                   = 1
Flush Interval                                    = 5
Transports                                        = EntityInfo,
                                                    EstimatedState,
                                                    Temperature,
                                                    Salinity,
                                                    Conductivity,
                                                    Pressure

[Transports.SMS]
Enabled                                             = Hardware
Entity Label                                        = SMS
Active                                              = true
Activation Time                                     = 10
Debug Level                                         = None
IO Port - Device                                    = uart:///dev/ttyUSB3:115200
Time to Check Mailbox in Seconds                    = 300
Maximum Time to Accept SMS in Hours                 = 24
Number of Consecutive Errors to Restart Task        = 5
Send SMS Text Messages                              = true

[Transports.UDP]
Transports+                                       = DissolvedOxygen
Filtered Entities                                 = CpuUsage:Daemon,
                                                    Distance:Altimeter+DVL Filtered+Echo Sounder,
                                                    Temperature:CTD+Depth Sensor+BATMAN,
                                                    Voltage:Batteries+Rhodamine+Turbidity+Chlorophyll+CELL 1+CELL 2+CELL 3+CELL 4+CELL 5+CELL 6+CELL 7+BATMAN,
                                                    Current:BATMAN+FCap+RCap
