############################################################################
# Copyright 2007-2020 Universidade do Porto - Faculdade de Engenharia      #
# Laboratório de Sistemas e Tecnologia Subaquática (LSTS)                  #
############################################################################
# This file is part of DUNE: Unified Navigation Environment.               #
#                                                                          #
# Commercial Licence Usage                                                 #
# Licencees holding valid commercial DUNE licences may use this file in    #
# accordance with the commercial licence agreement provided with the       #
# Software or, alternatively, in accordance with the terms contained in a  #
# written agreement between you and Faculdade de Engenharia da             #
# Universidade do Porto. For licensing terms, conditions, and further      #
# information contact lsts@fe.up.pt.                                       #
#                                                                          #
# Modified European Union Public Licence - EUPL v.1.1 Usage                #
# Alternatively, this file may be used under the terms of the Modified     #
# EUPL, Version 1.1 only (the "Licence"), appearing in the file LICENCE.md #
# included in the packaging of this file. You may not use this work        #
# except in compliance with the Licence. Unless required by applicable     #
# law or agreed to in writing, software distributed under the Licence is   #
# distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF     #
# ANY KIND, either express or implied. See the Licence for the specific    #
# language governing permissions and limitations at                        #
# https://github.com/LSTS/dune/blob/master/LICENCE.md and                  #
# http://ec.europa.eu/idabc/eupl.html.                                     #
############################################################################
# Author: Paulo Dias                                                       #
# Author: Maria Costa                                                      #
############################################################################

[Require ../common/imc-addresses.ini]
[Require ../common/transports.ini]
[Require ../common/maneuvers.ini]
[Require ../auv/transports.ini]
[Require ../auv/simulator.ini]
[Require ../auv/navigation.ini]
[Require ../auv/supervisors.ini]
[Require ../hardware/lctr-a6xx/gps.ini]
[Require ../hardware/lctr-a6xx/seatrac.ini]

[General]
Vehicle                                 = pioneer
Vehicle Type                            = rov
Absolute Maximum Depth                  = 150.0
Absolute Minimum Altitude               = 0.2
Underwater Depth Threshold              = 0.3
Maximum Absolute Speed                  = 1.5
Time Of Arrival Factor                  = 2.0

[IMC Addresses]
pioneer                                 = 0x0034

## Control ##

# [Control.Pioneer/Simulation]
# Enabled                                 = Simulation
# Entity Label                            = Pioneer Control 
# Debug Level                             = Debug
# #Communications timeout                  = 10
# Listen Mode                             = false
# Filter Out UDP not from Address for TCP = false
# Generate EstimatedState from Telemetry  = false
# TCP - Port                              = 6011
# TCP - Address                           = 127.0.0.1
# UDP - Listen Port                       = 6010
# Log Pioneer Raw Messages                = false
# Log Pioneer Raw Messages as IMC         = false
# Set Time of Vehicle                     = false
# Initial Position                        = 41.1850, -8.7062
# #Ping Replay Timeout                     = 0.0

[Control.Pioneer]
Enabled                                 = Hardware
Entity Label                            = Pioneer Control
Debug Level                             = Debug
#Communications timeout                  = 10
Listen Mode                             = false
Filter Out UDP not from Address for TCP = false
Generate EstimatedState from Telemetry  = false
TCP - Port                              = 2011
TCP - Address                           = 192.168.1.101
UDP - Listen Port                       = 2010
Log Pioneer Raw Messages                = true
Log Pioneer Raw Messages as IMC         = true
Set Time of Vehicle                     = true
# Initial Position                        = 41.1850, -8.7062
Ping Replay Timeout                     = 0.0
Motion Input Speed                      = 2

[Control.ROV.Depth]
Enabled                                 = Always
Entity Label                            = Depth Control
Vertical Motor Id                       = 3
Heave PID Gains                         = 4.0, 0.2, 0.1
Maximum Heave Reference                 = 1.0
Depth PID Gains                         = 1.0, 0.0, 0.0
Depth Integral Limit                    = -1
Maximum Thrust Reference                = 1.0

[Control.ROV.HorizontalPlaneV2]
Enabled                                 = Never
Entity Label                            = Horizontal Plane Control
Maximum Thrust Actuation                = 0.6
Maximum Thrust Differential Actuation   = 0.1
Ramp Actuation Limit                    = 0.0
Hardware RPMs Control                   = true
RPMs at Maximum Thrust                  = 1000
RPMs PID Gains                          = 1.0, 0.0, 0.0
RPMs Feedforward Gain                   = 1.0
MPS PID Gains                           = 0.0, 0.0, 0.0
MPS Integral Limit                      = 0.0
MPS Feedforward Gain                    = 1000.0
Minimum RPM Limit                       = 200
Maximum RPM Limit                       = 1000
Maximum RPM Acceleration                = 160
Yaw PID Gains                           = 1.0, 0.0, 0.0
Maximum Heading Error to Thrust         = 10.0
Enable Sway                             = true
Entity Label - Port Motor               = Motor - Port
Entity Label - Starboard Motor          = Motor - Starboard
Entity Label - Sway Motor               = Motor - Sway
Share Saturation                        = true
Log PID Parcels                         = true
Debug Level                             = None

#TOREVIEW (Thrust Allocation Pinv TBD)
[Control.ROV.HorizontalPlane]
Enabled                                 = Hardware
Entity Label                            = Horizontal Plane Control
Maximum Thrust Actuation                = 1.0
Horizontal Thruster Count               = 3
# Thruster control
# Thrust Allocation Pinv                  = 0.5 0.0 6.48900577494148,
#                                           0.5 0.0 -6.48900577494148,
#                                           0.0 1.0 0.0
# Direct control
Thrust Allocation Pinv                  = 1.0 0.0 0.0,
                                          0.0 1.0 0.0,
                                          0.0 0.0 1.0
Heading PID Gains                       = 1.0, 0.0, 0.0
Heading Integral Limit                  = -1
Heading Rate PID Gains                  = 2.0, 0.0, 0.1
Maximum Surge Reference                 = 1.0
Surge PID Gains                         = 0.5, 0.25, 0.1
Surge Integral Limit                    = 1.0
Maximum Sway Reference                  = 1.0
Sway PID Gains                          = 2.0, 0.3, 0.1
Sway Integral Limit                     = 1.0

#TOREVIEW
[Control.ROV.RemoteOperation]
Enabled                                 = Always
Entity Label                            = Remote Operation
Debug Level                             = Spew
Execution Frequency                     = 10
Connection Timeout                      = 2.0
Actuation Inverse Matrix                = 1.0 0.0 0.0 0.0 0.0 1.0,
                                          1.0 0.0 0.0 0.0 0.0 -1.0,
                                          0.0 1.0 0.0 0.0 0.0 0.0,
                                          0.0 0.0 1.0 0.0 0.0 0.0
Maximum Speed Allowed                   = 1.5
Depth and Heading Control               = true
Heading Tracking                        = false
Depth Rate                              = 0.01
Depth Action Dead Zone                  = 20
Heading Rate                            = 25
Depth Increment                         = 0.2
Wall Tracking -- Average Window         = 5
Wall Tracking -- Gains                  = 1.0, 0.0, 0.1
Wall Tracking -- Maximum Speed          = 0.5
Wall Tracking -- Integral Limit         = 0.2
Wall Tracking -- Absolute Maximum Error = 1.0
Wall Tracking -- Distance Increments    = 0.02
Wall Tracking -- Distance Bounds        = 0.15, 3.0
Entity Label - Wall Distance            = Pioneer Vision Control
Entity Label - Desired Wall Distance    = Desired Distance
Entity Label - Filtered Wall Distance   = Filtered Distance

[Maneuver.Teleoperation]
Enabled                                  = Always
Entity Label                             = Teleoperation Maneuver

[Control.Path.ROV]
Enabled                                 = Always
Entity Label                            = Path Control
Debug Level                             = None
ETA Minimum Speed                       = 0.1
Control Frequency                       = 10
Along-track -- Monitor                  = false
Cross-track -- Monitor                  = false
Position Jump Threshold                 = 10.0
Position Jump Time Factor               = 0.5
ETA Minimum Speed                       = 0.1
New Reference Timeout                   = 5.0
Course Control                          = true
Bottom Track -- Enabled                 = false
Bottom Track -- Forward Samples         = 7
Bottom Track -- Safe Pitch              = 35.0
Bottom Track -- Minimum Range           = 4.0
Bottom Track -- Slope Hysteresis        = 1.5
Bottom Track -- Check Trend             = false
Bottom Track -- Execution Frequency     = 5
Bottom Track -- Depth Avoidance         = true
Bottom Track -- Admissible Altitude     = 2.5
Fixed Heading                           = 0
Speed Limits                            = -1.0, 1.0, -0.5, 0.5
Wall Tracking -- Gains                  = 0.5, 0.0, 0.1

[Control.Path.VectorField]
Enabled                                 = Never

## Navigation ##

[Navigation.AUV.Navigation]
Enabled                                 = Never

[Navigation.General.ROV]
Enabled                                 = Always
Entity Label - Depth                    = Pioneer Control #Depth Sensor
Entity Label - Compass                  = Pioneer Control #AHRS
Entity Label - DVL                      = DVL
Entity Label - Altitude - Hardware      = DVL #DVL Filtered
Entity Label - Altitude - Simulation    = DVL #Altimeter
Disable USBL for debug                  = true

[Sensors.WaterLinkedDVL]
Enabled                                 = Hardware
Entity Label                            = DVL
Activation Time                         = 3.0
IO Port - Device                        = tcp://192.168.1.160:16171
Debug Level                             = Spew
Device Orientation                      = 0, 0, 180

[Sensors.GPS]
Enabled                                 = Hardware
Activation Time                         = 3.0
IO Port - Device                        = tcp://192.168.1.101:27644
Sentence Order                          = GPGSA, GPRMC, GPGGA

## Monitors ##

[Monitors.Entities]
Enabled                                 = Always
Entity Label                            = Entity Monitor
Report Timeout                          = 5
Default Monitoring                      = Daemon
Default Monitoring -- Hardware          = Pioneer Control

#TOREVIEW
[Monitors.Medium]
Enabled                                 = Always
Execution Frequency                     = 1
Entity Label                            = Medium
Entity Label - Medium Sensor            = Pioneer Control
Vehicle Type                            = UUV
Initialization Time                     = 30.0
GPS Timeout                             = 2.0

## Simulation ##

[Control.ROV.HorizontalPlane/Simulation]
Enabled                                 = Simulation
Entity Label                            = Horizontal Plane Control
Maximum Thrust Actuation                = 1.0
Horizontal Thruster Count               = 3
# Thruster control
# Thrust Allocation Pinv                  = 0.5 0.0 6.48900577494148,
#                                           0.5 0.0 -6.48900577494148,
#                                           0.0 1.0 0.0
Thrust Allocation Pinv                  = 1.0 0.0 0.5,
                                          1.0 0.0 -0.5,
                                          0.0 1.0 0.0
Heading PID Gains                       = 1.5, 0.0, 0.0
Heading Integral Limit                  = -1
Heading Rate PID Gains                  = 2.5, 0.0, 0.2
Maximum Surge Reference                 = 1.0
Surge PID Gains                         = 1.0, 0.0, 0.0
Maximum Sway Reference                  = 1.0
Sway PID Gains                          = 1.0, 0.0, 0.0

[Simulators.LBL]
Enabled                                 = Never

[Simulators.Motor]
Enabled                                 = Never

[Simulators.Servos]
Enabled                                 = Never

[Simulators.VSIM]
Enabled                                 = Simulation
Entity Label                            = Simulation Engine
Execution Frequency                     = 100

[Simulators.GPS]
Enabled                                 = Simulation
Entity Label                            = GPS

[Simulators.DVL]
Enabled                                 = Simulation
Execution Frequency                     = 5
Entity Label                            = DVL
Standard Deviation - Ground Velocity    = 0.002
Standard Deviation - Water Velocity     = 0.002
Invalid Reading Probability             = 10

[Simulators.DepthSensor]
Enabled                                 = Simulation
Entity Label                            = Depth Sensor

[Simulators.IMU/AHRS]
Enabled                                 = Simulation
Entity Label                            = AHRS
Standard Deviation - Euler Angles       = 0.05
Standard Deviation - Angular Velocity   = 0.05
Standard Deviation - Heading Offset     = 0
Gyro Rate Bias                          = 0

[Simulators.Motor/PortStern]
Enabled                                 = Simulation
Execution Frequency                     = 20
Entity Label                            = Port Stern Motor
Thruster Id                             = 0
Thruster Act to RPM Factor              = 50, 1000

[Simulators.Motor/StarboardStern]
Enabled                                 = Simulation
Execution Frequency                     = 20
Entity Label                            = Starboard Stern Motor
Thruster Id                             = 1
Thruster Act to RPM Factor              = 50, 1000

[Simulators.Motor/Sway]
Enabled                                 = Simulation
Execution Frequency                     = 20
Entity Label                            = Sway Motor
Thruster Id                             = 2
Thruster Act to RPM Factor              = 50, 1000

[Simulators.Motor/Heave]
Enabled                                 = Simulation
Execution Frequency                     = 20
Entity Label                            = Heave Motor
Thruster Id                             = 3
Thruster Act to RPM Factor              = 50, 1000

## Transports ##

[Transports.Logging]
Enabled                                 = Always
Execution Priority                      = 1
Entity Label                            = Logger
Debug Level                             = None
Activation Time                         = 0
Deactivation Time                       = 0
Execution Priority                      = 2
Flush Interval                          = 5
LSF Compression Method                  = gzip
LSF Volume Size                         = 0
Transports                              = Abort,
                                          Acceleration,
                                          AngularVelocity,
                                          Announce,
                                          Conductivity,
                                          ControlLoops,
                                          ControlParcel,
                                          CpuUsage,
                                          Current,
                                          DataSanity,
                                          Depth,
                                          DesiredControl,
                                          DesiredZ,
                                          DesiredHeading,
                                          DesiredHeadingRate,
                                          DesiredPath,
                                          DesiredPitch,
                                          DesiredSpeed,
                                          DesiredVelocity,
                                          DevCalibrationControl,
                                          DevCalibrationState,
                                          DevDataBinary,
                                          DevDataText,
                                          Distance,
                                          DvlRejection,
                                          EmergencyControl,
                                          EmergencyControlState,
                                          EntityActivationState,
                                          EntityList,
                                          EntityMonitoringState,
                                          EntityParameters,
                                          EntityState,
                                          EstimatedState,
                                          EstimatedStreamVelocity,
                                          EulerAngles,
                                          EulerAnglesDelta,
                                          FollowRefState,
                                          FuelLevel,
                                          GpsFix,
                                          GpsFixRejection,
                                          GroundVelocity,
                                          Heartbeat,
                                          IridiumMsgRx,
                                          IridiumMsgTx,
                                          IridiumTxStatus,
                                          LblConfig,
                                          LblEstimate,
                                          LblRange,
                                          LblRangeAcceptance,
                                          LogBookEntry,
                                          ManeuverControlState,
                                          MagneticField,
                                          PathControlState,
                                          PlanSpecification,
                                          PlanControl,
                                          PlanControlState,
                                          PlanDB,
                                          PathControlState,
                                          PopEntityParameters,
                                          PowerChannelControl,
                                          PowerChannelState,
                                          PushEntityParameters,
                                          Pressure,
                                          QueryEntityParameters,
                                          Reference,
                                          RemoteActions,
                                          RemoteActionsRequest,
                                          RemoteState,
                                          Rpm,
                                          RSSI,
                                          Salinity,
                                          SaveEntityParameters,
                                          Sms,
                                          SetEntityParameters,
                                          SetThrusterActuation,
                                          SonarData,
                                          SimulatedState,
                                          StopManeuver,
                                          SoundSpeed,
                                          TeleoperationDone,
                                          Temperature,
                                          TransmissionRequest,
                                          TransmissionStatus,
                                          UamTxFrame,
                                          UamRxFrame,
                                          UamTxStatus,
                                          UamRxRange,
                                          UsblAnglesExtended,
                                          UsblPositionExtended,
                                          UsblFixExtended,
                                          UsblModem,
                                          UsblConfig,
                                          VehicleCommand,
                                          VehicleMedium,
                                          VehicleState,
                                          Voltage,
                                          WaterDensity,
                                          WaterVelocity

[Transports.UDP]
Enabled                                 = Always
Entity Label                            = UDP
Transports                              = Abort,
                                          Acceleration,
                                          AngularVelocity,
                                          CpuUsage,
                                          Current,
                                          DesiredControl,
                                          DesiredHeading,
                                          DesiredSpeed,
                                          DesiredZ,
                                          DevCalibrationControl,
                                          DevCalibrationState,
                                          Distance,
                                          EmergencyControlState,
                                          EntityActivationState,
                                          EntityList,
                                          EntityParameters,
                                          EntityState,
                                          EstimatedState,
                                          EulerAngles,
                                          EulerAnglesDelta,
                                          FollowRefState,
                                          FuelLevel,
                                          GroundVelocity,
                                          GpsFix,
                                          GpsFixRejection,
                                          Heartbeat,
                                          IridiumMsgRx,
                                          IridiumMsgTx,
                                          IridiumTxStatus,
                                          LblEstimate,
                                          LblRange,
                                          LblRangeAcceptance,
                                          LblConfig,
                                          LogBookEntry,
                                          LogBookControl,
                                          MagneticField,
                                          OperationalLimits,
                                          PathControlState,
                                          PlanControl,
                                          PlanControlState,
                                          PlanDB,
                                          PlanGeneration,
                                          PowerChannelState,
                                          QueryEntityParameters,
                                          RemoteActions,
                                          RemoteActionsRequest,
                                          Rpm,
                                          SaveEntityParameters,
                                          SetEntityParameters,
                                          SimulatedState,
                                          StorageUsage,
                                          Temperature,
                                          TransmissionRequest,
                                          TransmissionStatus,
                                          UamTxFrame,
                                          UamRxFrame,
                                          UamTxStatus,
                                          UamRxRange,
                                          UsblAnglesExtended,
                                          UsblPositionExtended,
                                          UsblFixExtended,
                                          UsblModem,
                                          UsblConfig,
                                          VehicleMedium,
                                          VehicleState,
                                          Voltage,
                                          WaterVelocity
Rate Limiters                           = Current:0.1,
                                          EstimatedState:2,
                                          FuelLevel:0.1,
                                          Rpm:1,
                                          SimulatedState:2,
                                          StorageUsage:0.1,
                                          Temperature:0.1,
                                          Voltage:0.1
Local Port                              = 6002
Print Incoming Messages                 = 0
Print Outgoing Messages                 = 0

[Transports.CommManager]
Enabled                                 = Always
Entity Label                            = Communications Manager
Acoustic Address Section                = Seatrac Addresses BugWright2
Debug Level                             = Debug

[Transports.TCPOnDemand]
Enabled                                 = Always
Entity Label                            = TCP On Demand

[Transports.TCP.Server/TCPOnDemand]
Enabled                                 = Always
Entity Label                            = TCP On Demand Server
Announce Service                        = true
Debug Level                             = None
Activation Time                         = 0
Deactivation Time                       = 0
Execution Priority                      = 10
Port                                    = 6006
Trace - Incoming Messages               = true
Trace - Outgoing Messages               = false

[Transports.Seatrac]
Enabled                                 = Never
Debug Level                             = None
Entity Label                            = Acoustic Modem
# Serial Port - Device                    = /dev/ttyUSB0
# Serial Port - Baud Rate                 = 115200
Serial Port - Device                    = tcp://192.168.1.101:1001
Transmit Only Underwater                = true
Address Section                         = Seatrac Addresses BugWright2
AHRS Mode                               = false
Pressure Sensor Mode                    = true
Use Internal Pressure Sensor for Medium = false
USBL Mode                               = false
Enhanced USBL                           = false

[Transports.UAN]
Address Section                         = Seatrac Addresses BugWright2

[Control.ROV.HorizontalPlane/Simulation]
Debug Level                             = Spew

[Control.Path.ROV]
Debug Level                             = Debug

[Vision.Pioneer]
Enabled                                 = Always
Entity Label                            = Pioneer Vision Control
#Stream URL                              = /dev/video0
Stream URL                              = rtsp://192.168.1.101:8554/test
Debug Level                             = None
Maximum Fps                             = 8
Hue Interval                            = 35, 85
Saturation Interval                     = 50, 255
Value Interval                          = 50, 255
#Imshow options                         All, Cap, Proc, Input, None
Imshow Display                          = Cap
# Method options                        Lines, Template, Dots
Detection Method                        = Dots
Baseline Lasers                         = 10
Real Distance in Pixel                  = 68
Real Distance in cm                     = 70