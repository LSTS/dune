############################################################################
# Copyright 2007-2023 Universidade do Porto - Faculdade de Engenharia      #
# Laboratório de Sistemas e Tecnologia Subaquática (LSTS)                  #
############################################################################
# This file is part of DUNE: Unified Navigation Environment.               #
#                                                                          #
# Commercial Licence Usage                                                 #
# Licencees holding valid commercial DUNE licences may use this file in    #
# accordance with the commercial licence agreement provided with the       #
# Software or, alternatively, in accordance with the terms contained in a  #
# written agreement between you and Faculdade de Engenharia da             #
# Universidade do Porto. For licensing terms, conditions, and further      #
# information contact lsts@fe.up.pt.                                       #
#                                                                          #
# Modified European Union Public Licence - EUPL v.1.1 Usage                #
# Alternatively, this file may be used under the terms of the Modified     #
# EUPL, Version 1.1 only (the "Licence"), appearing in the file LICENCE.md #
# included in the packaging of this file. You may not use this work        #
# except in compliance with the Licence. Unless required by applicable     #
# law or agreed to in writing, software distributed under the Licence is   #
# distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF     #
# ANY KIND, either express or implied. See the Licence for the specific    #
# language governing permissions and limitations at                        #
# https://github.com/LSTS/dune/blob/master/LICENCE.md and                  #
# http://ec.europa.eu/idabc/eupl.html.                                     #
############################################################################
# Author: Pedro Gonçalves                                                  #
# Author: João Costa                                                       #
############################################################################
# AutoNaut configuration file                                              #
############################################################################

# Public
[Require asv/basic.ini]

# Private
[Require ../private/etc/power/cpc.ini]
[Require ../private/etc/sensors/hemispherev200s.ini]

############################################################################
# General Parameters.                                                      #
############################################################################

[General]
Vehicle                                             = caravel
Vehicle Type                                        = autonaut
Battery Capacity                                    = 90000

[Transports.Announce]
System Type                                         = usv

############################################################################
# Actuators.                                                               #
############################################################################

############################################################################
# Autonomy.                                                                #
############################################################################

[Autonomy.TextActions]
Enabled                                             = Always
Entity Label                                        = Text Actions
Valid Commands                                      = abort,
                                                      errors,
                                                      info,
                                                      force,
                                                      go,
                                                      help,
                                                      phone,
                                                      sk,
                                                      start
Debug Level                                         = None

############################################################################
# Control.                                                                 #
############################################################################

[Control.ASV.Autopilot]
Enabled                                             = Hardware
Entity Label                                        = Heading Controller
Activate Desired Course Filtering                   = false
Enable Gain Scheduling                              = false
Use new gains                                       = false
Preferred scheduling                                = adcp
Enable Thrust Assistance                            = true #false
Enable Thrust During Turn                           = true #false
Thrust Assistance                                   = 0.75
Maximum Thrust Actuation                            = 1.0
Minimum Speed for Thrust                            = 0.1
Maximum Rudder Actuation                            = 1.0
Course PID Gains Transect                           = 0.75, 0.001, 0.0
Course PID Gains Turning                            = 0.5, 0.0, 0.0
Ramp Actuation Limit                                = 0.0
Log PID Parcels                                     = true
Entity Label - Navigation                           = Navigation Manager
Activate LP Filtering                               = false
Activate N Filtering                                = false
Activate BS Filtering                               = false
Activate External Filtering                         = false
External Filter Type                                = LPF
LP taps                                             = 20
LPF scaling                                         = 1.2
NF taps                                             = 10
BSF taps                                            = 10
BSF scaling                                         = 20
External Filter Frequency                           = 1.0
Desired Course Percentage Increase                  = 30
Heading Control                                     = false
SOG threshold - Heading Control                     = 0.2
Gain Scheduling Interval                            = 60
Correlation Limit                                   = 0
Amplitude Limit                                     = 0
Vehicle Pitch Rate Limit                            = 18
Vehicle Roll Rate Limit                             = 20
Debug Level                                         = None
Enable speed controller                             = false

[Control.ASV.HeadingAndSpeed]
Enabled                                             = Never

[Control.ASV.RemoteOperation.DifferentialThrust]
Enabled                                             = Never

[Control.ASV.RemoteOperation.ThrusterAndRudder]
Enabled                                             = Always
Entity Label - CAS                                  = Path Control

[Control.Path.CAS]
Enabled                                             = Always
Entity Label                                        = Path Control
Entity Label - Navigation hardware                  = Navigation Manager
Entity Label - Navigation simulation                = Simulated Navigation Manager
Entity Label - Wind                                 = AirMar120WX   # Need fix for TS7250 (CPU AUX)
Entity Label - Heave                                = GPS           # Invalid source in simulation
Entity Label - Wave Frequency                       = Wave Frequency Estimator
Enable Collision Avoidance                          = false
Enable Anti Grounding                               = false
Maximum Obstacle Surveillance Range                 = 5000
Remove Disappeared Obstacles                        = 240
Prediction Horizon - Simulation Time                = 600
Horizon Time Step                                   = 5
Prediction Horizon Geog Constraints                 = 600
Weight on Time to Evaluation Instant                = 0.5
Weight on Time to Evaluation Instant for Grounding  = 0.05
Weight on Distance at Evaluation Instant            = 4.0
COLREGS Distance                                    = 1000.0
SB_MPC Surveillance Range                           = 2000.0
Minimum safe distance to vessels                    = 300.0
Minimum safe distance to land                       = 800.0
Cost of collisions                                  = 1.0
Cost of grounding                                   = 100.0
Weights environmental factors                       = 10.0,50.0,50.0,50.0,100.0 #bathymetry, heave, wave, wind, current
Cost of not complying COLREGS                       = 3.0
Cost of changing COLREGS                            = 100.0
PHI AH                                              = 68.5
PHI OT                                              = 68.5
PHI HO                                              = 22.5
PHI CR                                              = 68.5
Cost of Deviating from Nominal Speed                = 10.5
Cost of Changing Speed Offset                       = 0.5
Cost of Deviating from Nominal Course               = 1.5
Cost of Course change to SB                         = 0.5
Cost of Course change to Port                       = 0.9
Cost of Selecting Turn to SB                        = 1.5
Cost of Selecting Turn to Port                      = 10.5
Guidance Strategy                                   = 0
WP Acceptance Radius                                = 20.0
LOS lookahead distance                              = 300.0
LOS integral gain                                   = 0.0
Course offset range                                 = 90.0
Positive granularity                                = 15.0
# Digital map path                                    = /home/autonaut/autonaut-toolchain/L2/dune/misc/poi_depthmap_depare-rad-indexed.db #/opt/lsts
# Digital map resolution                              = 50.0
Radius around threat                                = 50.0
Course offsets                                      = 90.0,75.0,60.0,45.0,30.0,15.0,0.0,-15.0,-30.0,-45.0,-60.0,-75.0,-90.0
# Debug path                                          = /home/autonaut/autonaut-toolchain/L2/dune/misc/tests/
Course Control                                      = true
Along-track -- Monitor                              = false
Cross-track -- Monitor                              = false
# Minimum waypoint dist switch                        = 30.0
Debug Level                                         = None

[Control.Path.VectorField]
Enabled                                             = Never

############################################################################
# Maneuver.                                                               #
############################################################################

[Maneuver.CompassCalibration]
Enabled                                            = Always
Entity Label                                       = Compass Calibration Maneuver
Activation Time                                    = 0
Deactivation Time                                  = 0
Debug Level                                        = None
Execution Priority                                 = 10
Maximum Pitch Variation                            = 20.0
Entity Label - Compass                             = AHRS
Cross Track Tolerance                              = 1.0
Number Of Turns                                    = 50
Calibrate Compass                                  = true

############################################################################
# Navigation.                                                              #
############################################################################

[Navigation.General.Estimator]
Enabled                                             = Hardware
Entity Label                                        = Wave Frequency Estimator
Active                                              = false
Omega_f LPF cutoff frequency                        = 20.0
LPF taps                                            = 10.0
Data sampling frequency                             = 2.0
Estimation period                                   = 60.0
Estimation duration                                 = 120.0
Minimum gain                                        = 5.0
Maximum gain                                        = 20.0
Switching amplitude                                 = 0.2
WEF initial guess                                   = 1.0
Entity Label - Heave                                = GPS
Entity Label - EulerAngles                          = GPS
Debug Level                                         = None

[Navigation.General.Estimator/Simulation]
Enabled                                             = Simulation
Entity Label                                        = Wave Frequency Estimator
Active                                              = false
Omega_f LPF cutoff frequency                        = 20.0
LPF taps                                            = 10.0
Data sampling frequency                             = 2.0
Estimation period                                   = 60.0
Estimation duration                                 = 120.0
Minimum gain                                        = 5.0
Maximum gain                                        = 20.0
Switching amplitude                                 = 0.2
WEF initial guess                                   = 1.0
Entity Label - Heave                                = Simulated Heave
Entity Label - EulerAngles                          = Simulated IMU
Debug Level                                         = None

[Navigation.General.GPSNavigation]
Enabled                                             = Never
Entity Label                                        = GPS Navigation
Entity Label - GPS                                  = GPS
Entity Label - IMU                                  = Simulated IMU
Entity Label - Yaw                                  = Simulated IMU
Debug Level                                         = None

[Navigation.General.NavManager]
Enabled                                             = Hardware
# Need testing GPS -> AHRS, Heading check
Entity Label - Euler Angles                         = AHRS
Entity Label - Angular Velocity                     = AHRS
Main unit                                           = GPS

[Navigation.General.NavManager/Simulation]
Enabled                                             = Simulation
Entity Label                                        = Simulated Navigation Manager
Entity Label - Euler Angles                         = Simulated IMU
Entity Label - Angular Velocity                     = Simulated IMU
Main unit                                           = GPS
Input timeout                                       = 30

############################################################################
# Monitors.                                                                #
############################################################################

[Monitors.Clock]
Enabled                                             = Hardware
Entity Label                                        = Clock
Minimum GPS Fixes                                   = 30
Maximum Clock Offset                                = 2
Boot Synchronization Timeout                        = 60
Hardware Clock Synchronization Command              = hwclock -w

[Monitors.CPUSingleUsage]
Enabled                                             = Always
Entity Label                                        = CPU Usage
Activation Time                                     = 0
Deactivation Time                                   = 0
Debug Level                                         = None

[Monitors.CPUScaling]
Enabled                                             = Never
Entity Label                                        = CPU Scaling
Activation Time                                     = 0
Deactivation Time                                   = 0
Debug Level                                         = None
Use Linux Liquorix                                  = false
# Default linux kernel: powersave, ondemand, performance
# Liquorix linux kernel: ondemand, userspace, performance
Set CPU In Mode                                     = powersave
# CPU ARIES: 500MHz <> 1900MHz
Set Maximum CPU Frequency in MHz                    = 500

[Monitors.Emergency]
Enabled                                             = Hardware
Active                                              = true
Transmission Interface                              = Both
Lost Communications Timeout                         = 1800
SMS Recipient Number                                = +351912439480

[Monitors.Entities]
Default Monitoring                                  = Daemon,
                                                      GPS,
                                                      Operational Limits,
                                                      Path Control

Default Monitoring -- Hardware                      = Clock,
                                                      Navigation Manager

[Monitors.Medium]
Enabled                                             = Never

[Monitors.Servos]
Enabled                                             = Never

[Monitors.FuelLevel]
Enabled                                             = Never

[Monitors.Log]
Enabled                                             = Hardware
Entity Label                                        = Log Monitor
Log Timeout                                         = 1d

[Monitors.Payload]
Enabled                                             = Always
Entity Label                                        = Payload Monitor
Debug Level                                         = None
Maximum payload size                                = 250
Payload timeout                                     = 120
Payload Messages                                    = EstimatedState:Navigation Manager,
                                                      #Temperature:CTD,
                                                      #Temperature:AirMar120WX, #Just for testing
                                                      #Salinity:CTD,
                                                      #CurrentProfile:ADCP,
                                                      #Chlorophyll:Fluorometers,
                                                      #DissolvedOrganicMatter:Fluorometers,
                                                      #Turbidity:Fluorometers,
                                                      #AirSaturation:Dissolved Oxygen,
                                                      #DissolvedOxygen:Dissolved Oxygen,
                                                      EstimatedState:Simulated Navigation Manager
Message TTL                                         = 120

[Monitors.DUNEResources]
Enabled                                             = Always
Entity Label                                        = DUNE Resources Monitor
Debug Level                                         = None

############################################################################
# Power.                                                                   #
############################################################################

[Power.CPC]
Enabled                                             = Hardware
Entity Label                                        = CPC
IO Port - Device                                    = uart:///dev/ttyCPC:115200
Voltage Offset                                      = 1.0
# Change to false for auxiliar CPU
Is Main CPU                                         = false
# Mission, Test
# Change to "Mission" in real operation scenario
Operation Mode                                      = Mission
# -1 turn off the led, 0 turn on the led, > 0 blink the led at the period defined
LED Period                                          = 2 # seconds
Set PWM1 Minimum                                    = 40
Set PWM1 Center                                     = 90
Set PWM1 Maximum                                    = 140
# Change to true for CPU-AUX
Force Water Mode at Boot                            = true
# Change to false in real operation scenario
Set CPC to use NAV and Iridium at Boot              = false
Power Channel 3 Entity Label                        = BPUMPS
Power Channel 3 Turn On                             = true
Power Channel 4 Entity Label                        = WIFI
Power Channel 4 Turn On                             = true
Power Channel 5 Entity Label                        = Private (ETH)
Power Channel 5 Turn On                             = true
Power Channel 6 Entity Label                        = Private (AIS_P)
Power Channel 6 Turn On                             = false
Power Channel 7 Entity Label                        = IRIDIUM
Power Channel 7 Turn On                             = true
Power Channel 8 Entity Label                        = IMU
Power Channel 8 Turn On                             = true
Power Channel 9 Entity Label                        = GNSS
Power Channel 9 Turn On                             = true
#turn off to save sensor life
Power Channel 10 Entity Label                       = Private (ECHOTRIP)
Power Channel 10 Turn On                            = false
#turn off to save sensor life
Power Channel 11 Entity Label                       = Private (OXYGEN)
Power Channel 11 Turn On                            = false
Power Channel 12 Entity Label                       = Private (AIRMAR)
Power Channel 12 Turn On                            = false
#turn off to save sensor life
Power Channel 13 Entity Label                       = Private (CTD_P)
Power Channel 13 Turn On                            = false
Power Channel 14 Entity Label                       = LED
Power Channel 14 Turn On                            = true
#turn off to save sensor life
Power Channel 15 Entity Label                       = Private (DCP_P)
Power Channel 15 Turn On                            = false
Power Channel 16 Entity Label                       = Private (SPOT)
Power Channel 16 Turn On                            = false
Power Channel 17 Entity Label                       = ECHOMAX_P
Power Channel 17 Turn On                            = true
Power Channel 18 Entity Label                       = Private (MOBILE)
Power Channel 18 Turn On                            = false

############################################################################
# Sensors.                                                                 #
############################################################################

[Sensors.AirMar220WX]
Enabled                                             = Never
Entity Label                                        = AirMar120WX

[Sensors.AIS650]
Enabled                                             = Never

[Sensors.EcoPuckTriple]
Enabled                                             = Never
Entity Label                                        = Fluorometers

[Sensors.HemisphereV200s]
Enabled                                             = Hardware
IO Port - Device                                    = uart:///dev/ttyS10:19200
Entity Label                                        = GPS
Debug Level                                         = None

[Sensors.LIMU]
Enabled                                             = Hardware
Entity Label                                        = AHRS
Activation Time                                     = 20.0
IO Port - Device                                    = uart:///dev/ttyS9
Power Channel - Name                                =
Debug Level                                         = None
Output Frequency                                    = 20
Hard-Iron Calibration                               = 0.0410, -0.0470, 0.0
Last Calibration Time                               = 2024-05-09 14:04
Raw Data                                            = false
Timeout - Error                                     = 3.0
Timeout - Failure                                   = 6.0
Rotation Matrix                                     = 1.0, 0.0, 0.0,
                                                      0.0, 1.0, 0.0,
                                                      0.0, 0.0, 1.0

[Sensors.NortekADCP]
Enabled                                             = Never
Entity Label                                        = ADCP

[Sensors.ThermalZone]
Enabled                                             = Hardware
Entity Label                                        = Thermal Zone
Execution Frequency                                 = 1
Path                                                = /sys/class/thermal/thermal_zone0/temp
Entity Label - Temperature                          = Mainboard (Core)

[Sensors.Optode4835]
Enabled                                             = Never
Entity Label                                        = Dissolved Oxygen

[Sensors.RBRlegato3]
Enabled                                             = Never
Entity Label                                        = CTD

############################################################################
# Simulators.                                                              #
############################################################################

[Simulators.Autopilot]
Enabled                                             = Simulation
Entity Label                                        = Autopilot
Entity Label - Navigation                           = Simulated Navigation Manager
Entity Label - GPS                                  = GPS
Maximum Rudder Actuation                            = 1.0
Course PID Gains                                    = 0.75, 0.001, 0.0
Ramp Actuation Limit                                = 0.0
Log PID Parcels                                     = true
Desired turning rate                                = 0.0
Heading Control                                     = false
SOG threshold - Heading Control                     = 0.2
Thrust Assistance                                   = 0.75
Debug Level                                         = None

[Simulators.GPS]
Enabled                                             = Simulation
Entity Label                                        = GPS

[Simulators.Motor]
Enabled                                             = Simulation
Execution Frequency                                 = 20
Entity Label                                        = Motor
Thruster Id                                         = 0
Thruster Act to RPM Factor                          = 1.0, 3600.0

[Simulators.Motor/Port]
Enabled                                             = Never

[Simulators.Motor/Starboard]
Enabled                                             = Never

[Simulators.Servos]
Enabled                                             = Simulation
Entity Label                                        = Rudder Servo
Maximum Angle                                       = 45.0

[VSIM/Model/autonaut]
Type                                                =  Boat
Mass                                                =  180

############################################################################
# Supervisors.                                                             #
############################################################################

[Supervisors.ClockPPS]
Enabled                                             = Never

[Supervisors.Grounding]
Enabled                                             = Never
Entity Label                                        = ENC Parser
Digital Map Path                                    = /home/autonaut/autonaut-toolchain/L2/dune/misc/poi_depthmap_depare-rad-indexed.db
Debug Path                                          = /home/autonaut/autonaut-toolchain/L2/debug/
Digital Map Resolution                              = 50.0
Range Around Location                               = 300.0
Surroundings Check Frequency                        = 60
Check path depth                                    = true
Check path safety                                   = true
Check depth contours                                = true
Contours radius                                     = 2000
Safety depth threshold                              = 10
Corridor width                                      = 100
Entity Label - GPS simulation                       = GPS
Entity Label - GPS hardware                         = GPS
ENC Features                                        = BCN,LIGHTS,WRECKS,#CTNARE,DEPARE,EXEZNE,NAVLNE,OBSTRN,PILPNT,UWTROC,
Debug Level                                         = Debug

[Supervisors.Autonaut]
Enabled                                             = Always
Entity Label                                        = Autonaut Supervisor
Activation Time                                     = 0
Deactivation Time                                   = 0
Debug Level                                         = None
Execution Priority                                  = 10
Execution Frequency                                 = 2

############################################################################
# Transports.                                                              #
############################################################################

[Transports.GSM]
Enabled                                             = Hardware
Entity Label                                        = GSM
Activation Time                                     = 10
Deactivation Time                                   = 0
Debug Level                                         = None
Execution Priority                                  = 10
Serial Port - Device                                = /dev/ttyUSB3
Serial Port - Baud Rate                             = 115200
Reply Timeout                                       = 2.0
RSSI Periodicity                                    = 10
Read SMS Periodicity                                = 10
SMS Send Timeout                                    = 60
Request Balance                                     = false
USSD code                                           = 111

[Transports.IridiumSBD]
Enabled                                             = Hardware
Debug Level                                         = None
Entity Label                                        = Iridium Modem
Serial Port - Device                                = /dev/ttyS8
Serial Port - Baud Rate                             = 19200
Use 9523N Module                                    = true
Serial Port 9523 - Baud Rate                        = 115200
Mailbox Check - Periodicity                         = 300
Active                                              = true
Transmission Window                                 = 300
Reception Window                                    = 60

[Transports.Iridium]
Enabled                                             = Hardware
Entity Label                                        = Iridium Transport
Device updates - Periodicity                        = 600
Announce Periodicity                                = 600
Active                                              = true

[Transports.IridiumOperation]
Enabled                                             = Always
Entity Label                                        = Iridium Operation
Debug Level                                         = None
Maximum iridium payload size                        = 250
Message TTL                                         = 240
Iridium Operation Timeout                           = 1200
Transport                                           = PlanControl,
                                                      PlanControlState,
                                                      EstimatedState,
                                                      VehicleState,
                                                      StateReport,
                                                      FuelLevel,
                                                      Aborted
Rate Limiters                                       = PlanControlState:120,
                                                      EstimatedState:120,
                                                      VehicleState:120,
                                                      StateReport:120,
                                                      FuelLevel:120

[Transports.Logging]
Flush Interval                                      = 0.5

[Transports.UDP]
Transports+                                         = AisInfo,
                                                      RemoteSensorInfo,
                                                      DevDataText
Filtered Entities                                   = Distance:Altimeter+DVL Filtered+Echo Sounder,
                                                      DevDataText:AIS

############################################################################
# To test the limited msgs communication with the DUNE system.

#[Transports.UDP]
#Enabled                                             = Never
[Transports.UDP/Filtered]
Enabled                                             = Never
#Enabled                                             = Always
Entity Label                                        = UDP Filtered
Debug Level                                         = None
Activation Time                                     = 0
Deactivation Time                                   = 0
Execution Priority                                  = 10
Announce Service                                    = true
Contact Refresh Periodicity                         = 5.0
Contact Timeout                                     = 30
Dynamic Nodes                                       = true
Local Messages Only                                 = false
Local Port                                          = 6002
Print Incoming Messages                             = 0
Print Outgoing Messages                             = 0
Communication Range                                 = 0
Underwater Communications                           = true
Transports                                          = Aborted,
                                                      AirSaturation,
                                                      Chlorophyll,
                                                      CurrentProfile,
                                                      DissolvedOrganicMatter,
                                                      DissolvedOxygen,
                                                      EntityInfo,
                                                      EntityList,
                                                      EntityParameters,
                                                      EntityState,
                                                      EstimatedState,
                                                      FollowRefState,
                                                      FuelLevel,
                                                      IridiumMsgRx,
                                                      IridiumMsgTx,
                                                      IridiumTxStatus,
                                                      PathControlState,
                                                      PlanControl,
                                                      PlanControlState,
                                                      PlanDB,
                                                      Rpm,
                                                      Salinity,
                                                      SonarData,
                                                      StateReport,
                                                      Temperature,
                                                      Turbidity,
                                                      VehicleState
Filtered Entities                                   = Current:Batteries,
                                                      CpuUsage:Daemon,
                                                      Temperature:MainCore,
                                                      Voltage:Batteries
                                                      Distance:Altimeter+DVL Filtered+Echo Sounder,
                                                      Temperature:CTD+Depth Sensor+CTD Simulator,
                                                      Voltage:Batteries+Rhodamine+Turbidity+Chlorophyll
Rate Limiters                                       = Rpm:10,
                                                      Salinity:10,
                                                      Temperature:10
