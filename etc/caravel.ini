############################################################################
# Copyright 2007-2023 Universidade do Porto - Faculdade de Engenharia      #
# Laboratório de Sistemas e Tecnologia Subaquática (LSTS)                  #
############################################################################
# This file is part of DUNE: Unified Navigation Environment.               #
#                                                                          #
# Commercial Licence Usage                                                 #
# Licencees holding valid commercial DUNE licences may use this file in    #
# accordance with the commercial licence agreement provided with the       #
# Software or, alternatively, in accordance with the terms contained in a  #
# written agreement between you and Faculdade de Engenharia da             #
# Universidade do Porto. For licensing terms, conditions, and further      #
# information contact lsts@fe.up.pt.                                       #
#                                                                          #
# Modified European Union Public Licence - EUPL v.1.1 Usage                #
# Alternatively, this file may be used under the terms of the Modified     #
# EUPL, Version 1.1 only (the "Licence"), appearing in the file LICENCE.md #
# included in the packaging of this file. You may not use this work        #
# except in compliance with the Licence. Unless required by applicable     #
# law or agreed to in writing, software distributed under the Licence is   #
# distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF     #
# ANY KIND, either express or implied. See the Licence for the specific    #
# language governing permissions and limitations at                        #
# https://github.com/LSTS/dune/blob/master/LICENCE.md and                  #
# http://ec.europa.eu/idabc/eupl.html.                                     #
############################################################################
# Author: Pedro Gonçalves                                                  #
# Author: João Costa                                                       #
############################################################################
# AutoNaut configuration file                                              #
############################################################################

# Public
[Require asv/basic.ini]

# Private
[Require ../private/etc/sensors/nortek-adcp.ini]
[Require ../private/etc/power/cpc.ini]
[Require ../private/etc/sensors/hemispherev200s.ini]
[Require ../private/etc/ais.ini]

############################################################################
# General Parameters.                                                      #
############################################################################

[General]
Vehicle                                             = caravel
Vehicle Type                                        = autonaut
Battery Capacity                                    = 90000

############################################################################
# Actuators.                                                               #
############################################################################

############################################################################
# Autonomy.                                                                #
############################################################################

[Autonomy.TextActions]
Enabled                                             = Always
Entity Label                                        = Text Actions
Valid Commands                                      = abort,
                                                      dislodge,
                                                      dive,
                                                      errors,
                                                      info,
                                                      force,
                                                      cr6,
                                                      restart,
                                                      go,
                                                      help,
                                                      phone,
                                                      reboot,
                                                      sk,
                                                      start,
                                                      surface,
                                                      on,
                                                      off,
                                                      sensor,
                                                      sensors,
                                                      reports,
                                                      navstat,
                                                      adcp,
                                                      ctd,
                                                      ecopuck,
                                                      tblive,
                                                      optode
Debug Level                                         = Debug

############################################################################
# Control.                                                                 #
############################################################################

[Control.ASV.Autopilot]
Enabled                                             = Hardware
Entity Label                                        = Heading Controller
Activate Desired Course Filtering                   = false
Enable Gain Scheduling                              = false
Use new gains                                       = false
Preferred scheduling                                = adcp
Enable Thrust Assistance                            = true #false
Enable Thrust During Turn                           = true #false
Thrust Assistance                                   = 0.25
Maximum Thrust Actuation                            = 1.0
Minimum Speed for Thrust                            = 0.1
Maximum Rudder Actuation                            = 1.0
Course PID Gains Transect                           = 0.75, 0.001, 0.0
Course PID Gains Turning                            = 0.5, 0.0, 0.0
Ramp Actuation Limit                                = 0.0
Log PID Parcels                                     = true
Entity Label - Navigation                           = Navigation Manager
Activate LP Filtering                               = false
Activate N Filtering                                = false
Activate BS Filtering                               = false
Activate External Filtering                         = false
External Filter Type                                = LPF
LP taps                                             = 20
LPF scaling                                         = 1.2
NF taps                                             = 10
BSF taps                                            = 10
BSF scaling                                         = 20
External Filter Frequency                           = 1.0
Desired Course Percentage Increase                  = 30
Heading Control                                     = false
SOG threshold - Heading Control                     = 0.2
Gain Scheduling Interval                            = 60
Correlation Limit                                   = 0
Amplitude Limit                                     = 0
Vehicle Pitch Rate Limit                            = 18
Vehicle Roll Rate Limit                             = 20
Debug Level                                         = None

[Control.ASV.HeadingAndSpeed]
Enabled                                             = Never

[Control.ASV.RemoteOperation.DifferentialThrust]
Enabled                                             = Never

[Control.ASV.RemoteOperation.ThrusterAndRudder]
Enabled                                             = Always

[Control.Path.CAS]
Enabled                                             = Always  
Entity Label                                        = Path Control 
Entity Label - Navigation hardware                  = Navigation Manager
Entity Label - Navigation simulation                = GPS Navigation
Entity Label - Wind                                 = AirMar220WX
Entity Label - Heave                                = HemisphereGPS
Entity Label - Wave Frequency                       = Wave Frequency Estimator
Enable Collision Avoidance                          = true
Enable Anti Grounding                               = true
Maximum Obstacle Surveillance Range                 = 5000
Remove Disappeared Obstacles                        = 240
Prediction Horizon - Simulation Time                = 600
Horizon Time Step                                   = 5
Prediction Horizon Geog Constraints                 = 600
Weight on Time to Evaluation Instant                = 0.5
Weight on Time to Evaluation Instant for Grounding  = 0.05
Weight on Distance at Evaluation Instant            = 4.0
COLREGS Distance                                    = 1000.0
SB_MPC Surveillance Range                           = 2000.0
Minimum safe distance to vessels                    = 300.0
Minimum safe distance to land                       = 800.0
Cost of collisions                                  = 1.0
Cost of grounding                                   = 100.0
Weights environmental factors                       = 10.0,50.0,50.0,50.0,100.0 #bathymetry, heave, wave, wind, current
Cost of not complying COLREGS                       = 3.0
Cost of changing COLREGS                            = 100.0
PHI AH                                              = 68.5
PHI OT                                              = 68.5
PHI HO                                              = 22.5
PHI CR                                              = 68.5
Cost of Deviating from Nominal Speed                = 10.5
Cost of Changing Speed Offset                       = 0.5
Cost of Deviating from Nominal Course               = 1.5
Cost of Course change to SB                         = 0.5
Cost of Course change to Port                       = 0.9
Cost of Selecting Turn to SB                        = 1.5
Cost of Selecting Turn to Port                      = 10.5
Guidance Strategy                                   = 0
WP Acceptance Radius                                = 20.0
LOS lookahead distance                              = 300.0
LOS integral gain                                   = 0.0
Course offset range                                 = 90.0
Positive granularity                                = 15.0
# Digital map path                                    = /home/autonaut/autonaut-toolchain/L2/dune/misc/poi_depthmap_depare-rad-indexed.db #/opt/lsts
# Digital map resolution                              = 50.0
Radius around threat                                = 50.0
Course offsets                                      = 90.0,75.0,60.0,45.0,30.0,15.0,0.0,-15.0,-30.0,-45.0,-60.0,-75.0,-90.0
# Debug path                                          = /home/autonaut/autonaut-toolchain/L2/dune/misc/tests/
Course Control                                      = true
Along-track -- Monitor                              = false
Cross-track -- Monitor                              = false
# Minimum waypoint dist switch                        = 30.0
Debug Level                                         = None

[Control.Path.VectorField]
Enabled                                             = Never

############################################################################
# Maneuver.                                                               #
############################################################################

############################################################################
# Navigation.                                                              #
############################################################################

[Navigation.General.Estimator]
Enabled                                             = Hardware
Entity Label                                        = Wave Frequency Estimator
Active                                              = false
Omega_f LPF cutoff frequency                        = 20.0
LPF taps                                            = 10.0
Data sampling frequency                             = 2.0
Estimation period                                   = 60.0
Estimation duration                                 = 120.0
Minimum gain                                        = 5.0
Maximum gain                                        = 20.0
Switching amplitude                                 = 0.2
WEF initial guess                                   = 1.0
Entity Label - Heave                                = GPS
Entity Label - EulerAngles                          = GPS
Debug Level                                         = None

[Navigation.General.GPSNavigation]
Enabled                                             = Simulation

[Navigation.General.NavManager]
Enabled                                             = Hardware
Entity Label - Euler Angles                         = GPS
Entity Label - Angular Velocity                     = AHRS
Main unit                                           = GPS

############################################################################
# Monitors.                                                                #
############################################################################

[Monitors.Clock]
Enabled                                             = Hardware
Entity Label                                        = Clock
Minimum GPS Fixes                                   = 30
Maximum Clock Offset                                = 2
Boot Synchronization Timeout                        = 60
Hardware Clock Synchronization Command              = hwclock -w

[Monitors.CPUSingleUsage]
Enabled                                             = Hardware
Entity Label                                        = CPU Usage
Activation Time                                     = 0
Deactivation Time                                   = 0
Debug Level                                         = None

[Monitors.CPUScaling]
Enabled                                             = Hardware
Entity Label                                        = CPU Scaling
Activation Time                                     = 0
Deactivation Time                                   = 0
Debug Level                                         = None
# powersave | ondemand | performance
Set CPU In Mode                                     = powersave

[Monitors.Emergency]
SMS Recipient Number                                = +351912439480

[Monitors.Entities]
Default Monitoring                                  = Daemon,
                                                      GPS,
                                                      Navigation,
                                                      Operational Limits,
                                                      Path Control

Default Monitoring -- Hardware                      = Clock,
                                                      Collisions

[Monitors.Medium]
Enabled                                             = Never

[Monitors.Servos]
Enabled                                             = Never

[Monitors.FuelLevel]
Enabled                                             = Never

[Monitors.Log]
Enabled                                             = Hardware
Entity Label                                        = Log Monitor
Log Timeout                                         = 1d

############################################################################
# Power.                                                                   #
############################################################################

[Power.CPC]
Enabled                                             = Hardware
IO Port - Device                                    = uart:///dev/ttyS2:115200
Voltage Offset                                      = 1.0
# Mission, Test
# Change to "Mission" in real operation scenario
Operation Mode                                      = Test
# -1 turn off the led, 0 turn on the led, > 0 blink the led at the period defined
LED Period                                          = 2 # seconds
Set PWM1 Minimum                                    = 40
Set PWM1 Center                                     = 90
Set PWM1 Maximum                                    = 140

############################################################################
# Sensors.                                                                 #
############################################################################

[Sensors.AirMar220WX]
Enabled                                             = Hardware
Entity Label                                        = AirMar120WX
Activation Time                                     = 5.0
Deactivation Time                                   = 5.0
Debug Level                                         = None
IO Port - Device                                    = uart:///dev/ttyS8:4800
Input Timeout                                       = 4.0
Angle offset                                        = 5

[Sensors.AIS650]
Enabled                                             = Hardware
IO Port - Device                                    = uart:///dev/ttyS10:38400
Debug Level                                         = None

[Sensors.EcoPuckTriple]
Enabled                                             = Hardware
Entity Label                                        = Fluorometers
Debug Level                                         = None
Serial Port - Device                                = /dev/ttyS11
Serial Port - Baud Rate                             = 19200
Input Timeout                                       = 5.0

[Sensors.HemisphereV200s]
Enabled                                             = Hardware
IO Port - Device                                    = uart:///dev/ttyS9:19200
Entity Label                                        = GPS
Debug Level                                         = None

[Sensors.LIMU]
Enabled                                             = Hardware
Entity Label                                        = AHRS
Activation Time                                     = 20.0
IO Port - Device                                    = uart:///dev/ttyS4
Power Channel - Name                                =
Debug Level                                         = None
Output Frequency                                    = 20
Hard-Iron Calibration                               = 0.0, 0.0, 0.0
Raw Data                                            = false
Timeout - Error                                     = 3.0
Timeout - Failure                                   = 6.0
Rotation Matrix                                     = 1.0, 0.0, 0.0,
                                                      0.0, 1.0, 0.0,
                                                      0.0, 0.0, 1.0

[Sensors.NortekADCP]
Enabled                                             = Hardware
Entity Label                                        = ADCP
Activation Time                                     = 5
Debug Level                                         = None
IO Port - Device                                    = uart:///dev/ttyS6:115200
Timeout Transmitting Iridium Message                = 60
Start Acquisition                                   = false
Sample Time Duration                                = 60
Periodicity of Data Sampling                        = 80

[Sensors.ThermalZone]
Enabled                                             = Hardware
Entity Label                                        = Thermal Zone
Execution Frequency                                 = 1
Path                                                = /sys/class/thermal/thermal_zone0/temp
Entity Label - Temperature                          = Mainboard (Core)

[Sensors.Optode4835]
Enabled                                             = Hardware
Entity Label                                        = Dissolved Oxygen
Debug Level                                         = None
Execution Priority                                  = 20
Activation Time                                     = 60
IO Port - Device                                    = uart:///dev/ttyS7:9600
Measurement String Identifier                       = 4835
Entity Label - Temperature                          = CTD Temperature
Entity Label - Depth                                = CTD Depth
Entity Label - Salinity                             = CTD Salinity
Power Channel - Name                                = Dissolved Oxygen
Start Acquisition                                   = false
Sample Time Duration                                = 60
Periodicity of Data Sampling                        = 80
Timeout Transmitting Iridium Message                = 60

[Sensors.RBRlegato3]
Enabled                                             = Hardware
Entity Label                                        = CTD
Debug Level                                         = None
Activation Time                                     = 10.0
IO Port - Device                                    = uart:///dev/ttyS5:115200
Start Acquisition                                   = true
Sample Period (ms)                                  = 125
Sample Time Duration                                = 5
Periodicity of Data Sampling                        = 20
Power Channel - Name                                =
Input Timeout                                       = 26


############################################################################
# Simulators.                                                              #
############################################################################

[Simulators.Autopilot]
Enabled                                             = Simulation
Entity Label                                        = Autopilot
Entity Label - Navigation                           = GPS Navigation
Entity Label - GPS                                  = Simulated GPS
Maximum Rudder Actuation                            = 1.0
Course PID Gains                                    = 0.75, 0.001, 0.0
Ramp Actuation Limit                                = 0.0
Log PID Parcels                                     = true
Desired turning rate                                = 0.0
Heading Control                                     = false
SOG threshold - Heading Control                     = 0.2
Thrust Assistance                                   = 0.75
Debug Level                                         = None

[Simulators.Motor]
Enabled                                             = Simulation
Execution Frequency                                 = 20
Entity Label                                        = Motor
Thruster Id                                         = 0
Thruster Act to RPM Factor                          = 1.0, 3600.0

[Simulators.Motor/Port]
Enabled                                             = Never

[Simulators.Motor/Starboard]
Enabled                                             = Never

[Simulators.Servos]
Enabled                                             = Simulation
Entity Label                                        = Rudder Servo
Maximum Angle                                       = 45.0

[VSIM/Model/autonaut]
Type                                                =  Boat
Mass                                                =  180

############################################################################
# Supervisors.                                                             #
############################################################################

[Supervisors.ClockPPS]
Enabled                                             = Never

[Supervisors.Grounding]
Enabled                                             = Never
Entity Label                                        = ENC Parser
Digital Map Path                                    = /home/autonaut/autonaut-toolchain/L2/dune/misc/poi_depthmap_depare-rad-indexed.db
Debug Path                                          = /home/autonaut/autonaut-toolchain/L2/debug/
Digital Map Resolution                              = 50.0
Range Around Location                               = 300.0
Surroundings Check Frequency                        = 60
Check path depth                                    = true
Check path safety                                   = true
Check depth contours                                = true
Contours radius                                     = 2000
Safety depth threshold                              = 10
Corridor width                                      = 100
Entity Label - GPS simulation                       = GPS
Entity Label - GPS hardware                         = GPS
ENC Features                                        = BCN,LIGHTS,WRECKS,#CTNARE,DEPARE,EXEZNE,NAVLNE,OBSTRN,PILPNT,UWTROC,
Debug Level                                         = Debug

############################################################################
# Transports.                                                              #
############################################################################

[Transports.IridiumSBD]
Enabled                                             = Hardware
Debug Level                                         = None
Entity Label                                        = Iridium Modem
Serial Port - Device                                = /dev/ttyS3
Serial Port - Baud Rate                             = 19200
Use 9523N Module                                    = true
Serial Port 9523 - Baud Rate                        = 115200
Mailbox Check - Periodicity                         = 300
Active                                              = true

[Transports.Iridium]
Enabled                                             = Hardware
Entity Label                                        = Iridium Transport
Device updates - Periodicity                        = 600
Announce Periodicity                                = 600
Active                                              = true

[Transports.Logging]
Flush Interval                                      = 0.5

[Transports.UDP]
Filtered Entities                                    = Distance:Altimeter+DVL Filtered+Echo Sounder